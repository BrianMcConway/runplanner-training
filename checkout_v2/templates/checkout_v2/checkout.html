{% extends "base.html" %}
{% load static %}
{% load crispy_forms_tags %}

{% block content %}
<div class="container form-container">
    <h1>Checkout</h1>

    {% if messages %}
        <ul class="alert alert-danger">
            {% for message in messages %}
                <li{% if message.tags %} class="{{ message.tags }}"{% endif %}>{{ message }}</li>
            {% endfor %}
        </ul>
    {% endif %}

    <p class="total-amount">Total Amount: â‚¬{{ total }}</p>

    <!-- Success message container, hidden by default -->
    <div id="success-message" class="alert alert-success" style="display: none;">
        <h4>Thank you for your order!</h4>
        <p>Your payment was successful. A confirmation email has been sent.</p>
        <p>Order Number: <span id="order-id"></span></p>
    </div>

    <!-- Payment form -->
    <form id="payment-form" method="post" action="{% url 'checkout_v2:checkout' %}">
        {% csrf_token %}
        {{ order_form|crispy }}

        <div id="card-element" class="stripe-style-input"></div>
        <div id="card-errors" role="alert"></div>

        <button type="submit" id="submit-button" class="btn btn-primary btn-lg mt-3">Pay Now</button>
    </form>
</div>

<!-- Add JavaScript variables for Stripe configuration -->
<script>
    const stripePublicKey = "{{ stripe_public_key }}";
    const clientSecret = "{{ client_secret }}";
</script>

{% block postloadjs %}
<script src="{% static 'js/checkout.js' %}"></script>
{% endblock %}
{% endblock %}
